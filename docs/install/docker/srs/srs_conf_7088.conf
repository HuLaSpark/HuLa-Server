# 基础运行配置
listen              1935;
max_connections     1000;
daemon              off;
srs_log_tank        console;

# 低延迟优化
vhost __defaultVhost__ {
    tcp_nodelay     on;
    min_latency     on;
}

# HTTP API 服务（用于服务器状态管理）
http_api {
    enabled         on;
    listen          1985;
    crossdomain     on;
}

# HTTP 服务器（用于H5播放器拉流）
http_server {
    enabled         on;
    listen          7088;
    dir             ./objs/nginx/html;
}

# WebRTC 信令服务器配置
rtc_server {
    enabled         on;
    listen          8000;  # WebRTC信令端口
    candidate       192.168.1.37;  # 公网IP
}

# 虚拟主机配置
vhost __defaultVhost__ {
    # WebRTC 模式配置
    rtc {
        enabled     on;
        # 关闭 RTMP 转 WebRTC（避免强制中转，因为要实现P2P打视频）
        rtmp_to_rtc off;  # on：表示支持RTMP推流转WebRTC播放
        rtc_to_rtmp off;  # on：表示支持WebRTC推流转RTMP播放
        # P2P模式必须开启NACK
        nack         on;
        # 开启TWCC带宽估计
        twcc         on;
    }

    # HTTP-FLV 流配置
    http_remux {
        enabled     on;
        mount [vhost]/webrtc/;
    }

    # HLS 流配置（用于兼容性）
    hls {
        enabled         off;
    }

    # 低延迟播放配置
    play {
        gop_cache       off;  # 关闭GOP缓存降低延迟
        queue_length    10;   # 减小播放队列长度
    }
}